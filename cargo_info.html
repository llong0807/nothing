<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>货源信息详情</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Inter 字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles for the app screen wrapper */
        body {
            font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5; /* Light grey background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden; /* Prevent body scroll, content will scroll within app-screen */
            color: #333;
        }

        /* The main container simulating a phone screen */
        .app-screen {
            width: 375px; /* Standard mobile width */
            height: 812px; /* Standard mobile height */
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); /* Softer, larger shadow */
            overflow: hidden; /* Hide overflow content from rounded corners */
            display: flex;
            flex-direction: column;
            position: relative; /* For absolute positioning of pages and modals */
            transition: transform 0.3s ease-in-out; /* Smooth transition for potential future scaling */
        }

        /* Common Header Style */
        .header {
            padding: 15px 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            border-bottom: 1px solid #eee;
            background-color: #fff;
            color: #333;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); /* Subtle shadow for depth */
            position: relative; /* For potential back buttons */
            z-index: 10; /* Ensure header is on top */
            display: flex; /* Use flexbox for header content */
            justify-content: space-between; /* Space out items */
            align-items: center; /* Vertically align items */
        }

        /* New Test Button Style */
        #test-button {
            background-color: #ef4444; /* Red color */
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-left: 10px; /* Space from header title */
        }
        #test-button:hover {
            background-color: #dc2626; /* Darker red on hover */
        }

        /* Common Content Area */
        .content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto; /* Enable scrolling for content area */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            background-color: #f9f9f9; /* Light background for content */
        }

        /* Cargo Detail Page Styles */
        #cargo-detail-page { /* Apply to both shipper and driver detail pages */
            display: flex;
            flex-direction: column; /* Ensure content and footer stack */
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: #f0f2f5; /* Match body background for seamless look */
        }

        #cargo-detail-page .detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background-color: #fff;
            border-bottom: 1px solid #eee;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            flex-shrink: 0; /* Prevent header from shrinking */
        }

        #cargo-detail-page .detail-header .back-arrow {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            padding: 5px;
        }

        #cargo-detail-page .detail-header .header-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            flex-grow: 1; /* Allow title to take available space */
            text-align: center; /* Center the title */
        }

        #cargo-detail-page .detail-header .header-action-btn {
            background-color: transparent;
            color: #2196f3; /* Blue for share, red for delete */
            border: none;
            padding: 5px 10px;
            font-size: 15px;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.2s ease;
        }
        #cargo-detail-page .detail-header .header-action-btn.delete-btn {
            color: #e63946; /* Red for delete */
        }
        #cargo-detail-page .detail-header .header-action-btn:hover {
            background-color: #f0f0f0;
        }

        #cargo-detail-page .detail-content {
            flex-grow: 1; /* Allows content to take available space and scroll */
            padding: 15px; /* Reduced padding for sections to have their own padding */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            background-color: #f9f9f9;
            padding-bottom: 80px; /* Add padding to prevent content from being hidden by fixed footer */
        }

        #cargo-detail-page .detail-section {
            background-color: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }

        /* Route Section - Adjusted for vertical display and left alignment */
        #cargo-detail-page .route-section {
            display: flex;
            flex-direction: column; /* Stack vertically */
            align-items: flex-start; /* Align items to the left */
            gap: 10px; /* Space between the origin group, arrow, and destination group */
        }

        #cargo-detail-page .route-section .address-group {
            display: flex;
            align-items: flex-start;
            width: 100%; /* Take full width to allow internal content to align */
        }

        #cargo-detail-page .route-section .address-icon {
            font-size: 24px;
            margin-right: 8px;
        }
        #cargo-detail-page .route-section .origin-icon {
            color: #2196f3; /* Blue for origin */
        }
        #cargo-detail-page .route-section .destination-icon {
            color: #ff9800; /* Orange for destination */
        }


        #cargo-detail-page .route-section .address-info {
            flex-grow: 1;
        }

        /* Increased font sizes for elderly users */
        #cargo-detail-page .route-section .address-district {
            font-size: 22px; /* Increased from 20px */
            font-weight: bold;
            color: #333;
            line-height: 1.3;
        }

        #cargo-detail-page .route-section .address-detail {
            font-size: 19px; /* Increased from 17px */
            color: #666;
            line-height: 1.3;
        }

        #cargo-detail-page .route-section .route-arrow {
            font-size: 24px;
            font-weight: bold;
            color: #999;
            margin-left: 0;
            align-self: flex-start;
            padding-left: 0;
        }

        #cargo-detail-page .route-section .mileage-section {
            background-color: #f0f8ff; /* Very light blue background */
            border-radius: 12px;
            padding: 15px; /* Consistent padding on all sides */
            margin-top: 15px; /* Adjusted from 30px to 15px */
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: 100%; /* Take full width of its parent's content area */
            box-sizing: border-box; /* Ensure padding is included in the width */
        }
        #cargo-detail-page .route-section .mileage-section:hover {
            background-color: #e6f7ff;
        }

        #cargo-detail-page .mileage-info {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }

        #cargo-detail-page .mileage-value {
            font-size: 14px; /* Decreased by 2px from 16px */
            font-weight: bold;
            color: #333;
            margin-right: 10px;
        }

        #cargo-detail-page .mileage-reference {
            font-size: 9px; /* Decreased by 2px from 11px */
            color: #888;
            display: flex;
            align-items: center;
        }

        #cargo-detail-page .mileage-reference .exclamation-icon {
            font-size: 14px;
            color: #ff9800; /* Orange exclamation */
            margin-left: 5px;
        }

        #cargo-detail-page .map-link {
            display: flex;
            align-items: center;
            color: #2196f3; /* Blue for map link */
            font-size: 14px;
            font-weight: 500;
            text-decoration: none; /* Remove underline */
        }

        #cargo-detail-page .map-link .map-icon {
            font-size: 20px;
            margin-right: 5px;
        }

        /* Message Summary Section (CARD STYLING REINTRODUCED AND ENHANCED) */
        .message-summary-section {
            background-color: #FFF3E0; /* More distinct light orange/peach */
            border-radius: 12px;
            padding: 20px; /* Reintroduced padding */
            margin-bottom: 15px; /* Adjusted margin to fit within content flow */
            /* ENHANCED STYLES BELOW */
            box-shadow: 0 6px 16px rgba(0,0,0,0.15); /* Slightly stronger shadow */
            border: 2px solid #FFCC80; /* More prominent, matching border */
            transition: background-color 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
            display: block; /* Ensure it's a block element */
        }
        .message-summary-section:hover {
            background-color: #FFE6CC; /* Slightly darker orange on hover */
            box-shadow: 0 8px 20px rgba(0,0,0,0.2); /* More pronounced shadow on hover */
            border-color: #FFB347; /* Slightly darker border on hover */
        }

        /* Style for the header of message summary section */
        .message-summary-section .section-header {
            display: flex;
            justify-content: space-between; /* Space out title and view count */
            align-items: center;
            margin: 0; /* Reset all margins */
            padding: 0; /* Reset all paddings */
            margin-bottom: 5px; /* Explicit 5px margin below the header */
        }

        /* New style for the "消息摘要" plain text heading */
        .message-summary-heading-text {
            font-size: 16px; /* Keep it readable */
            font-weight: bold; /* Still bold for emphasis */
            color: #333;
            margin: 0;
            padding: 0;
            display: flex; /* To align icon and text inside it */
            align-items: center;
        }

        .message-summary-section .message-summary-heading-text .title-icon {
            font-size: 18px; /* Size of the icon */
            margin-right: 8px; /* Space between icon and text */
            color: #FF8C00; /* A distinct orange color for the icon */
        }

        /* Style for the "已浏览人数" text */
        .message-summary-section .view-count-text {
            font-size: 12px;
            color: #888;
            white-space: nowrap; /* Prevent text from wrapping */
        }


        /* Message list container */
        .message-summary-section .cargo-messages-list {
            margin: 0; /* Reset list margins */
            padding: 0; /* Reset list paddings */
            list-style: none; /* Remove default list bullets */
        }

        .message-summary-section .message-item {
            display: flex;
            flex-direction: column;
            padding: 6px 0; /* Adjusted from 8px to 6px for more compactness */
            border-bottom: 1px dashed #ffe0b2; /* Light orange dashed line */
        }
        .message-summary-section .message-item:last-of-type { /* Use last-of-type for the last message item */
            border-bottom: none;
            padding-bottom: 0;
        }

        .message-summary-section .message-line1 {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: #555;
            margin-bottom: 2px; /* Made line more compact */
            text-align: left;
        }
        .message-summary-section .message-line1 .user-avatar {
            width: 20px; /* Reduced by half (from 40px) */
            height: 20px; /* Reduced by half (from 40px) */
            border-radius: 50%;
            margin-right: 8px;
            object-fit: cover;
            border: 1px solid #ddd;
        }
        .message-summary-section .message-line1 .user-name {
            font-weight: bold;
            color: #333;
            margin-right: 5px;
        }
        .message-summary-section .message-line1 .intent-type {
            color: #e63946; /* Red for emphasis */
            font-weight: 600;
        }

        .message-summary-section .message-line2 {
            font-size: 12px; /* Smaller font for second line */
            color: #888;
            margin-bottom: 4px; /* Made line more compact */
            text-align: left;
            margin-left: 28px; /* Adjusted to align with text next to smaller avatar */
        }
        .message-summary-section .message-line2 .user-level {
            font-weight: 500;
            color: #2196f3; /* Blue for level */
            margin-right: 5px;
        }
        .message-summary-section .message-line2 .user-title {
            font-style: italic;
            color: #ff9800; /* Orange for title */
            margin-right: 10px;
        }


        .message-summary-section .message-actions {
            display: flex;
            justify-content: flex-end; /* Align buttons to the right */
            gap: 8px; /* Reduced gap between buttons */
            margin-top: 3px; /* Adjusted from 5px to 3px to reduce space above buttons */
        }

        .message-summary-section .message-actions .action-btn {
            background-color: #2196f3; /* Blue button */
            color: #fff;
            border: none;
            border-radius: 8px; /* More rounded */
            padding: 5px 8px; /* Reduced padding for buttons (approx 30%) */
            font-size: 10px; /* Reduced font size for buttons (approx 30%) */
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .message-summary-section .message-actions .action-btn:hover {
            background-color: #1976d2;
            transform: translateY(-1px);
        }
        .message-summary-section .message-actions .action-btn.secondary {
            background-color: #9e9e9e; /* Grey secondary */
        }
        .message-summary-section .message-actions .action-btn.secondary:hover {
            background-color: #757575;
        }

        .message-summary-section .view-more-link {
            display: block;
            text-align: center;
            margin-top: 15px;
            font-size: 14px;
            color: #2196f3;
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }
        .message-summary-section .view-more-link:hover {
            text-decoration: underline;
        }

        /* New style for "意向车方" card */
        .intended-driver-section {
            background-color: #e0f2f7; /* Light blue background */
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.15);
            border: 2px solid #81D4FA; /* Light blue border */
            display: flex;
            align-items: center;
            gap: 15px;
            transition: background-color 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        }

        .intended-driver-section:hover {
            background-color: #ccecf4;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            border-color: #4FC3F7;
        }

        .intended-driver-section .driver-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .intended-driver-section .driver-info {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .intended-driver-section .driver-name-phone {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }

        .intended-driver-section .driver-level-title {
            font-size: 13px;
            color: #666;
        }

        .intended-driver-section .contact-driver-btn {
            background-color: #2196f3;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }
        .intended-driver-section .contact-driver-btn:hover {
            background-color: #1976d2;
            transform: translateY(-1px);
        }


        /* Cargo Info and Fee Info Sections */
        #cargo-detail-page .section-title { /* Unified class for section titles */
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            text-align: left; /* All section titles now left-aligned */
        }

        #cargo-detail-page .info-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline; /* Align text baselines */
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px dashed #eee; /* Subtle separator */
        }
        #cargo-detail-page .info-row:last-child {
            border-bottom: none; /* No border for the last item */
            margin-bottom: 0;
            padding-bottom: 0;
        }

        #cargo-detail-page .info-label {
            font-size: 14px;
            color: #666;
            flex-shrink: 0; /* Prevent label from shrinking */
            margin-right: 15px; /* Space between label and value */
        }

        #cargo-detail-page .info-value {
            font-size: 15px;
            color: #333;
            font-weight: 500;
            text-align: right;
            flex-grow: 1; /* Allow value to take remaining space */
            word-break: break-word; /* Allow long text to wrap */
        }

        /* Fixed Footer for Detail Page */
        .detail-fixed-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 15px 20px;
            background-color: #fff;
            border-top: 1px solid #eee;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            z-index: 15;
            flex-shrink: 0;
            box-sizing: border-box;
        }
        .detail-fixed-footer .action-btn {
            background-color: #2196f3;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 14px;
            cursor: pointer;
            flex-shrink: 0;
            transition: background-color 0.2s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .detail-fixed-footer .action-btn:hover {
            background-color: #1976d2;
            transform: translateY(-1px);
        }
        .detail-fixed-footer .action-btn.secondary {
            background-color: #9e9e9e;
        }
        .detail-fixed-footer .action-btn.secondary:hover {
            background-color: #757575;
        }
        .detail-fixed-footer .action-btn.primary {
            background-color: #ff9800;
        }
        .detail-fixed-footer .action-btn.primary:hover {
            background-color: #fb8c00;
        }

        /* Modal Styles */
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .modal-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: #fff;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
            text-align: center;
            max-width: 80%;
            width: 280px;
            position: relative;
            transform: translateY(20px);
            transition: transform 0.3s ease-out;
        }

        .modal-overlay.visible .modal-content {
            transform: translateY(0);
        }

        .modal-content h3 {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }

        .modal-content .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .modal-content .modal-buttons .modal-btn {
            background-color: #2196f3;
            color: #fff;
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }

        .modal-content .modal-buttons .modal-btn:hover {
            background-color: #1976d2;
            transform: translateY(-1px);
        }

        .modal-content .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 24px;
            color: #999;
            cursor: pointer;
            padding: 5px;
            line-height: 1;
        }
        .modal-content .modal-close-btn:hover {
            color: #666;
        }

        /* Confirmation Modal Specific Styles */
        #confirmation-modal-overlay .modal-buttons {
            flex-direction: row; /* Buttons side-by-side */
            justify-content: center;
        }
        #confirmation-modal-overlay .modal-buttons .modal-btn {
            flex: 1; /* Distribute space evenly */
            margin: 0 5px; /* Small gap between buttons */
        }
        #confirmation-modal-overlay .modal-buttons .modal-btn.cancel-btn {
            background-color: #9e9e9e;
        }
        #confirmation-modal-overlay .modal-buttons .modal-btn.cancel-btn:hover {
            background-color: #757575;
        }

    </style>
</head>
<body>
    <div class="app-screen">
        <!-- Shipper's Cargo Detail Page -->
        <div id="cargo-detail-page">
            <div class="header detail-header">
                <span class="back-arrow" onclick="window.history.back()">←</span>
                <span class="header-title">货物信息</span>
                <!-- New Test Button -->
                <button id="test-button">测试</button>
                <button id="detail-action-btn" class="action-btn header-action-btn"></button>
            </div>

            <div class="content detail-content">
                <!-- NEW: Intended Driver Section (initially hidden) -->
                <div class="detail-section intended-driver-section" id="intended-driver-section" style="display: none;">
                    <img src="" alt="Driver Avatar" class="driver-avatar" id="intended-driver-avatar">
                    <div class="driver-info">
                        <div class="driver-name-phone" id="intended-driver-name-phone"></div>
                        <div class="driver-level-title" id="intended-driver-level-title"></div>
                    </div>
                    <button class="contact-driver-btn" id="contact-intended-driver-btn">联系车方</button>
                </div>

                <!-- NEW: Message Summary Section (CARD STYLING REINTRODUCED AND ENHANCED) -->
                <div class="detail-section message-summary-section" id="message-summary-section" style="display: none;">
                    <div class="section-header">
                        <span class="message-summary-heading-text">
                            <span class="title-icon">💡</span>消息摘要
                        </span>
                        <span class="view-count-text">已经有<span id="view-count">0</span>人浏览</span>
                    </div>
                    <div class="cargo-messages-list" id="cargo-messages-list">
                        <!-- Message items will be dynamically added here by JavaScript -->
                    </div>
                    <div class="view-more-link" onclick="alert('进入消息动态独立页面')">查看更多</div>
                </div>

                <!-- 货物信息区域 (路线) - Adjusted for vertical display and left alignment -->
                <div class="detail-section route-section">
                    <div class="address-group">
                        <span class="address-icon origin-icon">📍</span>
                        <div class="address-info">
                            <div class="address-district" id="origin-district"></div>
                            <div class="address-detail" id="origin-detail"></div>
                        </div>
                    </div>
                    <!-- Arrow aligned with icons -->
                    <span class="route-arrow">↓</span>
                    <div class="address-group">
                        <span class="address-icon destination-icon">📍</span>
                        <div class="address-info">
                            <div class="address-district" id="destination-district"></div>
                            <div class="address-detail" id="destination-detail"></div>
                        </div>
                    </div>

                    <!-- Mileage Section - Now inside route-section -->
                    <div class="mileage-section" id="shipper-map-link-container">
                        <div class="mileage-info">
                            <span class="mileage-value" id="mileage-display">正在计算</span>
                            <span class="mileage-reference">里程仅供参考 <span class="exclamation-icon">!</span></span>
                        </div>
                        <div class="map-link">
                            <span class="map-icon">🗺️</span>
                            <span>查看路线</span>
                        </div>
                    </div>
                </div>

                <!-- 货物信息区域 (详细属性) -->
                <div class="detail-section cargo-info-section">
                    <div class="section-title">货源信息</div>
                    <div class="info-row">
                        <span class="info-label">货物名称</span>
                        <span class="info-value" id="cargo-name"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">货物参数</span>
                        <span class="info-value" id="cargo-params"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">装卸时间</span>
                        <span class="info-value" id="load-time-detail"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">联系电话</span>
                        <span class="info-value" id="contact-phone"></span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">备注信息</span>
                        <span class="info-value" id="remarks"></span>
                    </div>
                </div>

                <!-- 费用信息区域 -->
                <div class="detail-section fee-info-section">
                    <div class="section-title">费用信息</div>
                    <div class="info-row">
                        <span class="info-label">运费</span>
                        <span class="info-value" id="freight-cost"></span>
                    </div>
                </div>
            </div>
            <!-- Fixed Footer for Detail Page -->
            <div class="detail-fixed-footer" id="cargo-detail-footer">
                <!-- Buttons will be dynamically added here -->
            </div>
        </div>

        <!-- Modal for Test Button -->
        <div id="test-modal-overlay" class="modal-overlay">
            <div class="modal-content">
                <button class="modal-close-btn" onclick="document.getElementById('test-modal-overlay').classList.remove('visible');">&times;</button>
                <h3>选择货源状态</h3>
                <div class="modal-buttons">
                    <button class="modal-btn" onclick="loadCargo('pub001', 'published')">发布中</button>
                    <button class="modal-btn" onclick="loadCargo('fc001', 'found-car')">已找车</button>
                    <button class="modal-btn" onclick="loadCargo('can002', 'cancelled')">已取消</button>
                </div>
            </div>
        </div>

        <!-- Confirmation Modal for "选择该车方" -->
        <div id="confirmation-modal-overlay" class="modal-overlay">
            <div class="modal-content">
                <button class="modal-close-btn" onclick="document.getElementById('confirmation-modal-overlay').classList.remove('visible');">&times;</button>
                <h3>提醒</h3>
                <p>选择该车方后，货源将进行下架处理，其他人无法查看，是否继续？</p>
                <div class="modal-buttons">
                    <button class="modal-btn cancel-btn" onclick="document.getElementById('confirmation-modal-overlay').classList.remove('visible');">取消</button>
                    <button class="modal-btn" id="confirm-select-driver-btn">继续</button>
                </div>
            </div>
        </div>

        <!-- New Modal for "取消货源" -->
        <div id="cancel-cargo-modal-overlay" class="modal-overlay">
            <div class="modal-content">
                <button class="modal-close-btn" onclick="document.getElementById('cancel-cargo-modal-overlay').classList.remove('visible');">&times;</button>
                <h3>你要取消货源吗</h3>
                <p>取消货源后货源将进入已作废列表，是否取消</p>
                <div class="modal-buttons">
                    <button class="modal-btn cancel-btn" onclick="document.getElementById('cancel-cargo-modal-overlay').classList.remove('visible');">忽略</button>
                    <button class="modal-btn" id="confirm-cancel-cargo-btn">继续取消</button>
                </div>
            </div>
        </div>

        <!-- New Modal for "找车完成" -->
        <div id="complete-cargo-modal-overlay" class="modal-overlay">
            <div class="modal-content">
                <button class="modal-close-btn" onclick="document.getElementById('complete-cargo-modal-overlay').classList.remove('visible');">&times;</button>
                <h3>你要关闭货源吗</h3>
                <p>完成后您将要作废该货源，是否作废。</p>
                <div class="modal-buttons">
                    <button class="modal-btn cancel-btn" onclick="document.getElementById('complete-cargo-modal-overlay').classList.remove('visible');">忽略</button>
                    <button class="modal-btn" id="confirm-complete-cargo-btn">继续</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Function to get the title based on user level
        function getUserTitle(level) {
            if (level >= 1 && level <= 10) return '无名小卒';
            if (level >= 11 && level <= 20) return '初入江湖';
            if (level >= 21 && level <= 30) return '略有小成';
            if (level >= 31 && level <= 40) return '驾轻就熟';
            if (level >= 41 && level <= 50) return '融会贯通';
            if (level >= 51 && level <= 60) return '炉火纯青';
            if (level >= 61 && level <= 70) return '出类拔萃';
            if (level >= 71 && level <= 80) return '神乎其技';
            if (level >= 81 && level <= 90) return '出神入化';
            if (level >= 91 && level <= 100) return '登峰造极';
            if (level >= 101 && level <= 110) return '一代宗师';
            if (level >= 111 && level <= 120) return '天下无双';
            return '未知等级'; // Default for levels outside defined ranges
        }

        // Sample Cargo Data (expanded for detail page)
        const allCargoData = {
            'published': [
                {
                    id: 'pub001',
                    route: '北京西城区到上海浦东新区',
                    publishTime: '6月27日',
                    cargoName: '电子产品',
                    cargoParams: '5吨, 3.2x2x1.5米',
                    loadTime: '随到随装',
                    contactPhone: '138****1234',
                    remarks: '需恒温运输，易碎品，请小心搬运。',
                    freightCost: '5000元',
                    originDistrict: '北京市西城区',
                    originDetail: '金融街18号',
                    destinationDistrict: '上海市浦东新区',
                    destinationDetail: '陆家嘴环路1000号',
                    dynamicAlert: "李师傅刚刚收藏了您的货源！", // This will trigger messages section
                    mileage: '约1200公里',
                    messages: [
                        { time: '06.25 15:20', user: '李师傅', phoneSuffix: '6666', type: '申请', avatar: 'https://placehold.co/20x20/FF5733/FFFFFF?text=L', level: 5, fullPhone: '13812346666' },
                        { time: '06.25 14:00', user: '王司机', phoneSuffix: '8888', type: '关注', avatar: 'https://placehold.co/20x20/33FF57/FFFFFF?text=W', level: 15, fullPhone: '13987658888' },
                        { time: '06.25 10:30', user: '赵师傅', phoneSuffix: '1111', type: '意向', avatar: 'https://placehold.co/20x20/5733FF/FFFFFF?text=Z', level: 25, fullPhone: '13011221111' }
                    ]
                },
                {
                    id: 'pub002',
                    route: '深圳南山区到广州天河区',
                    publishTime: '6月26日',
                    cargoName: '生鲜蔬菜',
                    cargoParams: '2吨, 2.5x1.8x1米',
                    loadTime: '7月1日',
                    contactPhone: '139****5678',
                    remarks: '需冷藏，上午10点前送达。',
                    freightCost: '面议',
                    originDistrict: '深圳市南山区',
                    originDetail: '科技园南区1号',
                    destinationDistrict: '广州市天河区',
                    destinationDetail: '珠江新城花城大道',
                    dynamicAlert: "已有意向车主，点击查看>", // This will trigger messages section
                    mileage: '约100公里',
                    messages: [
                        { time: '06.26 09:00', user: '钱师傅', phoneSuffix: '5555', type: '意向', avatar: 'https://placehold.co/20x20/FF33A1/FFFFFF?text=Q', level: 35, fullPhone: '13122335555' },
                        { time: '06.26 08:30', user: '孙师傅', phoneSuffix: '4444', type: '关注', avatar: 'https://placehold.co/20x20/33A1FF/FFFFFF?text=S', level: 45, fullPhone: '13244554444' }
                    ]
                },
                {
                    id: 'pub003',
                    route: '成都武侯区到重庆渝北区',
                    publishTime: '6月25日',
                    cargoName: '家具',
                    cargoParams: '10方, 4x2x2米',
                    loadTime: '随到随装',
                    contactPhone: '130****9012',
                    remarks: '拆卸后运输，需协助搬运上楼。',
                    freightCost: '3500元',
                    originDistrict: '成都市武侯区',
                    originDetail: '武侯祠大街231号',
                    destinationDistrict: '重庆市渝北区',
                    destinationDetail: '解放碑街道民权路',
                    dynamicAlert: null, // No dynamic alert for this one, so no messages section
                    messages: []
                }
            ],
            'found-car': [
                {
                    id: 'fc001',
                    route: '广州番禺区到深圳宝安区',
                    publishTime: '6月24日',
                    cargoName: '服装',
                    cargoParams: '2吨, 2x1.5x1米',
                    loadTime: '6月28日',
                    contactPhone: '131****3456',
                    remarks: '已联系司机王师傅，等待确认。',
                    freightCost: '1800元',
                    originDistrict: '广州市番禺区',
                    originDetail: '市桥街光明南路',
                    destinationDistrict: '深圳市宝安区',
                    destinationDetail: '新安街道宝安大道',
                    dynamicAlert: null,
                    mileage: '约80公里',
                    messages: []
                },
                {
                    id: 'fc002',
                    route: '上海静安区到杭州西湖区',
                    publishTime: '6月23日',
                    cargoName: '电子设备',
                    cargoParams: '3吨, 3x2x1.8米',
                    loadTime: '随到随装',
                    contactPhone: '132****7890',
                    remarks: '已匹配司机李师傅，请尽快联系。',
                    freightCost: '2500元',
                    originDistrict: '上海市静安区',
                    originDetail: '南京西路123号',
                    destinationDistrict: '杭州市西湖区',
                    destinationDetail: '西溪湿地文二西路',
                    dynamicAlert: null,
                    mileage: '约170公里',
                    messages: []
                }
            ],
            'cancelled': [
                {
                    id: 'can001',
                    route: '成都武侯区到重庆渝北区',
                    publishTime: '6月22日',
                    cargoName: '家具',
                    cargoParams: '10方, 4x2x2米',
                    loadTime: '6月25日',
                    contactPhone: '133****1122',
                    remarks: '因货主临时有变，已取消。',
                    freightCost: '3500元',
                    originDistrict: '成都市武侯区',
                    originDetail: '武侯祠大街231号',
                    destinationDistrict: '重庆市渝北区',
                    destinationDetail: '解放碑街道民权路',
                    dynamicAlert: null,
                    mileage: '约300公里',
                    messages: []
                },
                {
                    id: 'can002',
                    route: '北京朝阳区到天津滨海新区',
                    publishTime: '6月21日',
                    cargoName: '建筑材料',
                    cargoParams: '8吨, 3x2x1米',
                    loadTime: '随到随装',
                    contactPhone: '134****3344',
                    remarks: '货源已过期，需重新发布。',
                    freightCost: '2000元',
                    originDistrict: '北京市朝阳区',
                    originDetail: '望京SOHO',
                    destinationDistrict: '天津市滨海新区',
                    destinationDetail: '天津港保税区',
                    dynamicAlert: null,
                    mileage: '约140公里',
                    messages: []
                }
            ]
        };

        // Global variable to store the currently selected driver for "found-car" status
        let currentSelectedDriver = null;

        // Function to get the title based on user level
        function getUserTitle(level) {
            if (level >= 1 && level <= 10) return '无名小卒';
            if (level >= 11 && level <= 20) return '初入江湖';
            if (level >= 21 && level <= 30) return '略有小成';
            if (level >= 31 && level <= 40) return '驾轻就熟';
            if (level >= 41 && level <= 50) return '融会贯通';
            if (level >= 51 && level <= 60) return '炉火纯青';
            if (level >= 61 && level <= 70) return '出类拔萃';
            if (level >= 71 && level <= 80) return '神乎其技';
            if (level >= 81 && level <= 90) return '出神入化';
            if (level >= 91 && level <= 100) return '登峰造极';
            if (level >= 101 && level <= 110) return '一代宗师';
            if (level >= 111 && level <= 120) return '天下无双';
            return '未知等级'; // Default for levels outside defined ranges
        }

        // Function to populate and show the Cargo Detail Page (Shipper)
        function showCargoDetailPage(cargoItem, status, selectedDriverInfo = null) {
            // Populate route information
            document.getElementById('origin-district').textContent = cargoItem.originDistrict;
            document.getElementById('origin-detail').textContent = cargoItem.originDetail;
            document.getElementById('destination-district').textContent = cargoItem.destinationDistrict;
            document.getElementById('destination-detail').textContent = cargoItem.destinationDetail;

            // Populate cargo details
            document.getElementById('cargo-name').textContent = cargoItem.cargoName;
            document.getElementById('cargo-params').textContent = cargoItem.cargoParams;
            document.getElementById('load-time-detail').textContent = cargoItem.loadTime;
            document.getElementById('contact-phone').textContent = cargoItem.contactPhone;
            document.getElementById('remarks').textContent = cargoItem.remarks;

            // Populate fee information
            document.getElementById('freight-cost').textContent = cargoItem.freightCost;

            // Populate mileage information
            const mileageDisplay = document.getElementById('mileage-display');
            mileageDisplay.textContent = '正在计算'; // Initial state
            setTimeout(() => {
                mileageDisplay.textContent = cargoItem.mileage || '未知里程'; // Simulate calculation
            }, 1000); // Simulate a 1-second calculation time

            // Set up the "查看路线" link for shipper
            const shipperMapLinkContainer = document.getElementById('shipper-map-link-container');
            shipperMapLinkContainer.onclick = () => {
                const originAddress = `${cargoItem.originDistrict}${cargoItem.originDetail}`;
                const destinationAddress = `${cargoItem.destinationDistrict}${cargoItem.destinationDetail}`;
                // In a real scenario, this would link to a map service or an internal map page
                alert(`查看从 ${originAddress} 到 ${destinationAddress} 的路线`);
            };

            // Get references to message summary and intended driver sections
            const messageSummarySection = document.getElementById('message-summary-section');
            const intendedDriverSection = document.getElementById('intended-driver-section');
            const cargoMessagesList = document.getElementById('cargo-messages-list');

            // Reset display for both sections
            messageSummarySection.style.display = 'none';
            intendedDriverSection.style.display = 'none';
            cargoMessagesList.innerHTML = ''; // Clear previous messages

            // Conditional display based on status
            if (status === 'published') {
                if (cargoItem.messages && cargoItem.messages.length > 0) {
                    messageSummarySection.style.display = 'block'; // Show the section

                    // Update view count
                    const viewCountElement = document.getElementById('view-count');
                    if (viewCountElement) {
                        // Generate a random number between 100 and 500 for demonstration
                        viewCountElement.textContent = Math.floor(Math.random() * 401) + 100;
                    }

                    // Display up to 2 messages
                    cargoItem.messages.slice(0, 2).forEach(msg => {
                        const messageItem = document.createElement('div');
                        messageItem.classList.add('message-item');

                        // Determine display text for message type
                        let messageTypeText = msg.type;
                        if (msg.type === '关注') {
                            messageTypeText = '关注此货源';
                        } else if (msg.type === '申请') {
                            messageTypeText = '有承接意向';
                        }

                        // Conditionally render action buttons based on message type
                        const actionsHtml = msg.type === '关注' ? '' : `
                            <div class="message-actions">
                                <button class="action-btn secondary" onclick="event.stopPropagation(); alert('联系车方: ${msg.fullPhone}')">联系车方</button>
                                <button class="action-btn" onclick="event.stopPropagation(); showConfirmationModal('${cargoItem.id}', '${msg.user}', '${msg.phoneSuffix}', '${msg.avatar}', ${msg.level}, '${msg.fullPhone}')">选择该车方</button>
                            </div>
                        `;

                        messageItem.innerHTML = `
                            <div class="message-line1">
                                <img src="${msg.avatar}" alt="用户头像" class="user-avatar">
                                <span class="user-name">${msg.user}</span>
                                <span class="phone-suffix">尾号${msg.phoneSuffix}</span>
                                <span class="intent-type">${messageTypeText}</span>
                            </div>
                            <div class="message-line2">
                                <span class="user-level">L${msg.level}</span>
                                <span class="user-title">${getUserTitle(msg.level)}</span>
                                <span>${msg.time}</span>
                            </div>
                            ${actionsHtml}
                        `;
                        cargoMessagesList.appendChild(messageItem);
                    });
                }
            } else if (status === 'found-car') {
                intendedDriverSection.style.display = 'flex'; // Show the intended driver section
                // Populate intended driver details
                if (selectedDriverInfo) {
                    document.getElementById('intended-driver-avatar').src = selectedDriverInfo.avatar;
                    document.getElementById('intended-driver-name-phone').textContent = `${selectedDriverInfo.name} (尾号${selectedDriverInfo.phoneSuffix})`;
                    document.getElementById('intended-driver-level-title').textContent = `L${selectedDriverInfo.level} ${getUserTitle(selectedDriverInfo.level)}`;
                    document.getElementById('contact-intended-driver-btn').onclick = () => alert(`联系意向车方: ${selectedDriverInfo.fullPhone}`);
                    currentSelectedDriver = selectedDriverInfo; // Store for later use if needed
                }
            }


            // Set header action button
            const detailActionBtn = document.getElementById('detail-action-btn');
            if (status === 'cancelled') {
                detailActionBtn.textContent = '删除';
                detailActionBtn.classList.add('delete-btn');
                detailActionBtn.onclick = () => alert('删除货源: ' + cargoItem.id);
            } else {
                detailActionBtn.textContent = '分享';
                detailActionBtn.classList.remove('delete-btn');
                detailActionBtn.onclick = () => alert('分享货源: ' + cargoItem.id);
            }

            // Dynamically populate fixed footer buttons
            const detailFooter = document.getElementById('cargo-detail-footer');
            detailFooter.innerHTML = ''; // Clear existing buttons

            let buttonsToCreate = [];
            if (status === 'published') {
                buttonsToCreate = [
                    { text: '撤销', className: 'secondary', action: () => alert('撤销货源: ' + cargoItem.id) },
                    { text: '修改', className: 'secondary', action: () => alert('修改货源: ' + cargoItem.id) },
                    { text: '优先曝光', className: 'primary', action: () => alert('优先曝光货源: ' + cargoItem.id) }
                ];
            } else if (status === 'found-car') {
                buttonsToCreate = [
                    { text: '联系意向车主', className: '', action: () => alert('联系意向车主: ' + currentSelectedDriver.fullPhone) },
                    { text: '取消货源', className: 'secondary', action: () => showCancelCargoModal(cargoItem.id) },
                    { text: '找车完成', className: 'primary', action: () => showCompleteCargoModal(cargoItem.id) }
                ];
            } else if (status === 'cancelled') {
                buttonsToCreate = [
                    { text: '再次发布', className: 'primary', action: () => alert('再次发布货源: ' + cargoItem.id) }
                ];
            }

            buttonsToCreate.forEach(btnInfo => {
                const button = document.createElement('button');
                button.textContent = btnInfo.text;
                button.classList.add('action-btn');
                if (btnInfo.className) {
                    button.classList.add(btnInfo.className);
                }
                button.onclick = btnInfo.action;
                detailFooter.appendChild(button);
            });
        }

        // Function to show the confirmation modal for "选择该车方"
        function showConfirmationModal(cargoId, driverName, phoneSuffix, avatar, level, fullPhone) {
            const confirmationModalOverlay = document.getElementById('confirmation-modal-overlay');
            const confirmSelectDriverBtn = document.getElementById('confirm-select-driver-btn');

            // Store driver info temporarily for the "继续" action
            const driverInfo = { name: driverName, phoneSuffix: phoneSuffix, avatar: avatar, level: level, fullPhone: fullPhone };

            // Set up the "继续" button's action
            confirmSelectDriverBtn.onclick = () => {
                confirmationModalOverlay.classList.remove('visible');
                // Simulate the action of selecting a driver and taking cargo offline
                alert(`已选择 ${driverName} 作为承运方，货源 '${cargoId}' 已下架。请尽快与车方私聊。`);
                // Load the cargo in 'found-car' status and pass the selected driver info
                loadCargo(cargoId, 'found-car', driverInfo);
            };

            confirmationModalOverlay.classList.add('visible');
        }

        // Function to show the "取消货源" modal
        function showCancelCargoModal(cargoId) {
            const cancelCargoModalOverlay = document.getElementById('cancel-cargo-modal-overlay');
            const confirmCancelCargoBtn = document.getElementById('confirm-cancel-cargo-btn');

            confirmCancelCargoBtn.onclick = () => {
                cancelCargoModalOverlay.classList.remove('visible');
                alert(`货源 '${cargoId}' 已取消，并进入已作废列表。`);
                loadCargo(cargoId, 'cancelled');
            };
            cancelCargoModalOverlay.classList.add('visible');
        }

        // Function to show the "找车完成" modal
        function showCompleteCargoModal(cargoId) {
            const completeCargoModalOverlay = document.getElementById('complete-cargo-modal-overlay');
            const confirmCompleteCargoBtn = document.getElementById('confirm-complete-cargo-btn');

            confirmCompleteCargoBtn.onclick = () => {
                completeCargoModalOverlay.classList.remove('visible');
                alert(`货源 '${cargoId}' 已完成，并已作废。`);
                loadCargo(cargoId, 'cancelled'); // Assuming "找车完成" also leads to 'cancelled' or 'completed' state
            };
            completeCargoModalOverlay.classList.add('visible');
        }


        // Function to load cargo based on ID and status
        function loadCargo(cargoId, status, selectedDriverInfo = null) {
            // Hide all modals first
            document.getElementById('test-modal-overlay').classList.remove('visible');
            document.getElementById('confirmation-modal-overlay').classList.remove('visible');
            document.getElementById('cancel-cargo-modal-overlay').classList.remove('visible');
            document.getElementById('complete-cargo-modal-overlay').classList.remove('visible');


            // Find the cargo item based on the provided cargoId and status
            let cargoItem = null;
            if (allCargoData[status]) {
                cargoItem = allCargoData[status].find(item => item.id === cargoId);
            }

            // If not found in the target status, try to find it in other statuses to get its data
            if (!cargoItem) {
                for (const s in allCargoData) {
                    cargoItem = allCargoData[s].find(item => item.id === cargoId);
                    if (cargoItem) break;
                }
            }

            if (cargoItem) {
                // If the status is changing to 'found-car', ensure selectedDriverInfo is passed
                if (status === 'found-car' && !selectedDriverInfo && currentSelectedDriver) {
                    selectedDriverInfo = currentSelectedDriver; // Use the globally stored driver if available
                }
                showCargoDetailPage(cargoItem, status, selectedDriverInfo);
            } else {
                alert(`未找到 ID 为 '${cargoId}' 的货源信息，或状态 '${status}' 无效。`);
                console.warn(`Cargo with ID '${cargoId}' not found or invalid status '${status}'.`);
            }
        }

        // Initialize the page on window load
        window.onload = function() {
            console.log('window.onload executed.');

            // Get references to the test button and modal
            const testButton = document.getElementById('test-button');
            const testModalOverlay = document.getElementById('test-modal-overlay');

            // Add event listener to show the modal when the test button is clicked
            testButton.addEventListener('click', () => {
                testModalOverlay.classList.add('visible');
            });

            // Add event listener to hide the modal when clicking outside the content
            testModalOverlay.addEventListener('click', (event) => {
                if (event.target === testModalOverlay) {
                    testModalOverlay.classList.remove('visible');
                }
            });

            // Add event listeners for new modals to close when clicking outside
            document.getElementById('cancel-cargo-modal-overlay').addEventListener('click', (event) => {
                if (event.target === document.getElementById('cancel-cargo-modal-overlay')) {
                    document.getElementById('cancel-cargo-modal-overlay').classList.remove('visible');
                }
            });
            document.getElementById('complete-cargo-modal-overlay').addEventListener('click', (event) => {
                if (event.target === document.getElementById('complete-cargo-modal-overlay')) {
                    document.getElementById('complete-cargo-modal-overlay').classList.remove('visible');
                }
            });


            // Determine which cargo to load initially (always default to pub001, published for this demo)
            let initialCargoItem = allCargoData['published'][0];
            let initialStatus = 'published';

            // Display the initial cargo details
            if (initialCargoItem) {
                showCargoDetailPage(initialCargoItem, initialStatus);
            } else {
                alert('没有可显示的默认货源信息。');
                console.error('No default cargo data available.');
            }
        };
    </script>
</body>
</html>
