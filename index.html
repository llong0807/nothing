<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>手机物流App原型</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Inter 字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles for the app screen wrapper */
        body {
            font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f2f5; /* Light grey background */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden; /* Prevent body scroll, content will scroll within app-screen */
            color: #333;
        }

        /* The main container simulating a phone screen */
        .app-screen {
            width: 375px; /* Standard mobile width */
            height: 812px; /* Standard mobile height */
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); /* Softer, larger shadow */
            overflow: hidden; /* Hide overflow content from rounded corners */
            display: flex;
            flex-direction: column;
            position: relative; /* For absolute positioning of pages */
            transition: transform 0.3s ease-in-out; /* Smooth transition for potential future scaling */
        }

        /* Hidden by default, shown by JS */
        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            opacity: 0;
            pointer-events: none; /* Disable interaction when hidden */
            transition: opacity 0.3s ease-in-out; /* Smooth fade in/out */
            background-color: #fff; /* Ensure page background is white */
        }

        .page.active {
            opacity: 1;
            pointer-events: all; /* Enable interaction when active */
        }

        /* Common Header Style */
        .header {
            padding: 15px 20px;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            border-bottom: 1px solid #eee;
            background-color: #fff;
            color: #333;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); /* Subtle shadow for depth */
            position: relative; /* For potential back buttons */
            z-index: 10; /* Ensure header is on top */
        }

        /* Common Content Area */
        .content {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto; /* Enable scrolling for content area */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
            background-color: #f9f9f9; /* Light background for content */
        }

        /* Footer / Tab Bar styles */
        .footer {
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #eee;
            background-color: #fff;
            box-shadow: 0 -1px 3px rgba(0, 0, 0, 0.05); /* Subtle shadow for depth */
            z-index: 10; /* Ensure footer is on top */
        }

        .tab-button {
            flex: 1;
            text-align: center;
            padding: 8px 0;
            font-size: 12px;
            color: #888;
            cursor: pointer;
            transition: color 0.2s ease-in-out;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }

        .tab-button .icon {
            font-size: 20px;
        }

        /* Page-specific styles */

        /* Login Page */
        #login-page {
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #e0f7fa, #c8e6c9); /* Soft gradient background */
        }
        #login-page .logo {
            font-size: 56px; /* Larger logo */
            font-weight: bold;
            color: #007bff;
            margin-bottom: 80px; /* Reverted margin */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        #login-page .login-button {
            width: 80%;
            padding: 18px; /* Larger padding */
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 12px; /* More rounded */
            font-size: 20px; /* Larger font */
            cursor: pointer;
            margin-bottom: 25px; /* More space */
            box-shadow: 0 6px 15px rgba(0, 123, 255, 0.3); /* Prominent shadow */
            transition: all 0.3s ease;
        }
        #login-page .login-button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        #login-page .login-options {
            font-size: 15px;
            color: #555;
            text-align: center;
        }
        #login-page .login-options a {
            color: #007bff;
            text-decoration: none;
            margin: 0 10px;
            font-weight: 500;
        }

        /* Identity Selection Page */
        #identity-page {
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #f0f4f8, #e7eff3); /* Another soft gradient */
        }
        #identity-page .identity-title {
            font-size: 28px; /* Larger title */
            font-weight: bold;
            margin-bottom: 60px; /* More space */
            color: #333;
            text-align: center;
        }
        #identity-page .identity-card {
            width: 75%; /* Slightly narrower */
            padding: 40px 20px; /* More padding */
            margin-bottom: 35px; /* More space */
            border-radius: 20px; /* More rounded */
            text-align: center;
            font-size: 24px; /* Larger font */
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08); /* Initial shadow */
        }
        #identity-page .identity-card:hover {
            transform: translateY(-8px); /* More pronounced lift */
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.15); /* Enhanced shadow on hover */
        }
        #identity-page .identity-card .icon {
            font-size: 50px; /* Larger icon */
            margin-bottom: 20px; /* More space */
            display: block; /* Ensure icon is block to center text below it */
        }
        #identity-page .shipper-card {
            background-color: #e3f2fd; /* Light blue */
            color: #2196f3; /* Blue */
            border: 2px solid #2196f3;
        }
        #identity-page .driver-card {
            background-color: #fff3e0; /* Light orange */
            color: #ff9800; /* Orange */
            border: 2px solid #ff9800;
            }

        /* Shipper Home Page */
        #shipper-home-iframe-page .header {
            color: #2196f3; /* Blue header for shipper */
        }

        /* MODIFIED: Driver pages now have orange active tab color */
        #driver-find-cargo-iframe-page .tab-button.active,
        #driver-cargo-manage-iframe-page .tab-button.active,
        #driver-my-page .tab-button.active {
            color: #ff9800;
        }

        /* Driver Cargo Management Page */
        #driver-cargo-manage-iframe-page .header {
            color: #ff9800; /* Orange header */
        }
        #driver-cargo-manage-iframe-page .tabs {
            display: flex;
            justify-content: space-around;
            border-bottom: 1px solid #eee;
            background-color: #fcfcfc;
            padding: 5px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.03);
        }
        #driver-cargo-manage-iframe-page .tab {
            flex: 1;
            text-align: center;
            padding: 12px 0;
            font-size: 15px;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        #driver-cargo-manage-iframe-page .tab.active {
            color: #ff9800; /* Active orange */
            border-bottom-color: #ff9800;
            font-weight: bold;
        }
        #driver-cargo-manage-iframe-page .cargo-list {
            flex-grow: 1;
            overflow-y: auto;
            padding: 15px 20px;
        }
        #driver-cargo-manage-iframe-page .cargo-item {
            background-color: #fff;
            border: 1px solid #ffe0b2; /* Orange border */
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s ease-in-out;
        }
        #driver-cargo-manage-iframe-page .cargo-item:hover {
            transform: translateY(-3px);
        }
        #driver-cargo-manage-iframe-page .cargo-item h4 {
            margin-top: 0;
            margin-bottom: 12px;
            color: #333;
            font-size: 18px;
        }
        #driver-cargo-manage-iframe-page .cargo-item p {
            margin: 6px 0;
            font-size: 14px;
            color: #555;
            line-height: 1.5;
        }
        #driver-cargo-manage-iframe-page .cargo-actions {
            text-align: right;
            margin-top: 15px;
        }
        #driver-cargo-manage-iframe-page .cargo-actions button {
            background-color: #ff9800; /* Orange button */
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 14px;
            cursor: pointer;
            margin-left: 10px;
            transition: background-color 0.2s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        #driver-cargo-manage-iframe-page .cargo-actions button:hover {
            background-color: #fb8c00;
            transform: translateY(-1px);
        }
        #driver-cargo-manage-iframe-page .cargo-actions button.secondary {
            background-color: #9e9e9e;
        }
        #driver-cargo-manage-iframe-page .cargo-actions button.secondary:hover {
            background-color: #757575;
        }

        /* Driver My Page */
        #driver-my-page .header {
            color: #ff9800; /* Orange header */
        }
        #driver-my-page .profile-header {
            background: linear-gradient(135deg, #ff9800, #ffc107); /* Orange gradient */
            color: #fff;
            padding: 35px 20px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        #driver-my-page .avatar {
            width: 90px;
            height: 90px;
            background-color: #fff;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
            color: #ff9800; /* Orange icon color */
            border: 4px solid #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        #driver-my-page .nickname {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        #driver-my-page .level-online {
            font-size: 15px;
            opacity: 0.9;
        }
        #driver-my-page .switch-identity-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: rgba(255, 255, 255, 0.2);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.4);
            border-radius: 15px;
            padding: 8px 12px;
            font-size: 14px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        #driver-my-page .switch-identity-btn:hover {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        #driver-my-page .section-title {
            font-size: 17px;
            font-weight: bold;
            color: #424242;
            padding: 18px 20px 12px;
            border-bottom: 1px solid #eee;
            background-color: #fcfcfc;
        }
        #driver-my-page .menu-item {
            display: flex;
            align-items: center;
            padding: 18px 20px;
            border-bottom: 1px solid #f5f5f5;
            color: #555;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        #driver-my-page .menu-item:last-of-type {
            border-bottom: none;
        }
        #driver-my-page .menu-item:hover {
            background-color: #f5f5f5;
        }
        #driver-my-page .menu-item .icon {
            margin-right: 18px;
            font-size: 22px;
            color: #ff9800; /* Orange icon color */
        }
        #driver-my-page .menu-item .arrow {
            margin-left: auto;
            color: #bbb;
            font-size: 18px;
        }
        #driver-my-page .settings-button {
            width: 90%;
            padding: 18px;
            background-color: #e0e0e0;
            color: #333;
            border: none;
            border-radius: 12px;
            font-size: 17px;
            text-align: center;
            cursor: pointer;
            margin: 30px auto 20px;
            display: block;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transition: background-color 0.2s ease, transform 0.2s ease;
        }
        #driver-my-page .settings-button:hover {
            background-color: #bdbdbd;
            transform: translateY(-1px);
        }

        /* NEW: Styles for detail pages */
        .detail-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 20px;
            background-color: #fff;
            border-bottom: 1px solid #eee;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            flex-shrink: 0;
        }
        .detail-header .back-arrow {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            cursor: pointer;
            padding: 5px;
        }
        .detail-header .header-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .detail-header .header-action-btn {
            background-color: transparent;
            color: #2196f3;
            border: none;
            padding: 5px 10px;
            font-size: 15px;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.2s ease;
        }
        .detail-header .header-action-btn.delete-btn { color: #e63946; }
        .detail-header .header-action-btn:hover { background-color: #f0f0f0; }
        .detail-content {
            flex-grow: 1;
            padding: 15px;
            overflow-y: auto;
            background-color: #f9f9f9;
            padding-bottom: 80px;
        }
        .detail-section {
            background-color: #fff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
        }
        .route-section {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 10px;
        }
        .route-section .address-group {
            display: flex;
            align-items: flex-start;
            width: 100%;
        }
        .route-section .address-icon {
            font-size: 24px;
            margin-right: 8px;
        }
        .route-section .origin-icon { color: #2196f3; }
        .route-section .destination-icon { color: #ff9800; }
        .route-section .address-info { flex-grow: 1; }
        .route-section .address-district {
            font-size: 22px;
            font-weight: bold;
            color: #333;
            line-height: 1.3;
        }
        .route-section .address-detail {
            font-size: 19px;
            color: #666;
            line-height: 1.3;
        }
        .route-section .route-arrow {
            font-size: 24px;
            font-weight: bold;
            color: #999;
            margin-left: 0;
            align-self: flex-start;
            padding-left: 0;
        }
        .route-section .mileage-section {
            background-color: #f0f8ff;
            border-radius: 12px;
            padding: 15px 20px;
            margin-top: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            cursor: pointer;
            transition: background-color 0.2s ease;
            width: calc(100% - 40px);
        }
        .route-section .mileage-section:hover { background-color: #e6f7ff; }
        .mileage-info {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }
        .mileage-value {
            font-size: 14px;
            font-weight: bold;
            color: #333;
            margin-right: 10px;
        }
        .mileage-reference {
            font-size: 9px;
            color: #888;
            display: flex;
            align-items: center;
        }
        .mileage-reference .exclamation-icon {
            font-size: 14px;
            color: #ff9800;
            margin-left: 5px;
        }
        .map-link {
            display: flex;
            align-items: center;
            color: #2196f3;
            font-size: 14px;
            font-weight: 500;
            text-decoration: none;
        }
        .map-link .map-icon {
            font-size: 20px;
            margin-right: 5px;
        }
        .section-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            text-align: left;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px dashed #eee;
        }
        .info-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .info-label {
            font-size: 14px;
            color: #666;
            flex-shrink: 0;
            margin-right: 15px;
        }
        .info-value {
            font-size: 15px;
            color: #333;
            font-weight: 500;
            text-align: right;
            flex-grow: 1;
            word-break: break-word;
        }
        .detail-fixed-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 15px 20px;
            background-color: #fff;
            border-top: 1px solid #eee;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.08);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            z-index: 15;
            flex-shrink: 0;
            box-sizing: border-box;
        }
        .detail-fixed-footer .action-btn {
            background-color: #2196f3;
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 10px 15px;
            font-size: 14px;
            cursor: pointer;
            flex-shrink: 0;
            transition: background-color 0.2s ease, transform 0.2s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        .detail-fixed-footer .action-btn:hover {
            background-color: #1976d2;
            transform: translateY(-1px);
        }
        .detail-fixed-footer .action-btn.secondary { background-color: #9e9e9e; }
        .detail-fixed-footer .action-btn.secondary:hover { background-color: #757575; }
        .detail-fixed-footer .action-btn.primary { background-color: #ff9800; }
        .detail-fixed-footer .action-btn.primary:hover { background-color: #fb8c00; }
    </style>
</head>
<body>
<div class="app-screen">

    <!-- 1. Original Login Page (Now shown by default) -->
    <div id="login-page" class="page active">
        <div class="logo">物流App</div>
        <!-- MODIFIED: onclick now shows the name input modal -->
        <button class="login-button" onclick="showPage('name-modal-page')">一键登录</button>
        <div class="login-options">
            <a href="#">短信验证码登录</a> | <a href="#">忘记密码</a>
        </div>
    </div>

    <!-- NEW: Name Input Modal Page -->
    <div id="name-modal-page" class="page justify-center items-center" style="background-color: rgba(0, 0, 0, 0.6); z-index: 20;">
        <!-- The stopPropagation here prevents clicks inside the modal from bubbling up, if you were to add a "close on overlay click" feature. -->
        <div class="bg-white rounded-xl p-8 text-center w-11/12 max-w-xs shadow-2xl" onclick="event.stopPropagation();">
            <h2 class="text-xl font-bold mb-2 text-gray-800">您怎么称呼？</h2>
            <p class="text-sm text-gray-500 mb-5">输入一个昵称，让大家更好地认识你</p>
            <input id="nickname-input" type="text" placeholder="请输入您的昵称" class="w-full border border-gray-300 rounded-lg px-4 py-2 mb-6 focus:outline-none focus:ring-2 focus:ring-blue-500 transition">
            <div class="flex justify-center gap-4">
                <!-- Visually de-emphasized skip button -->
                <button onclick="handleModalClose(false)" class="flex-1 bg-transparent border border-gray-300 text-gray-600 py-2.5 rounded-lg hover:bg-gray-100 transition-colors text-base">跳过</button>
                <!-- Visually emphasized confirm button -->
                <button onclick="handleModalClose(true)" class="flex-1 bg-blue-500 text-white py-2.5 rounded-lg hover:bg-blue-600 transition-colors shadow-lg shadow-blue-500/30 text-base font-semibold">确认</button>
            </div>
        </div>
    </div>


    <!-- 2. Identity Selection Page -->
    <div id="identity-page" class="page">
        <div class="identity-title">请选择您的身份</div>
        <div class="identity-card shipper-card" onclick="showPage('shipper-home-iframe-page')">
            <span class="icon">📦</span>
            我要发货
        </div>
        <!-- MODIFIED: onclick now points to the new iframe page -->
        <div class="identity-card driver-card" onclick="showPage('driver-find-cargo-iframe-page')">
            <span class="icon">🚚</span>
            我要找货
        </div>
    </div>

    <!-- 3. Shipper's Home Page (iframe) -->
    <div id="shipper-home-iframe-page" class="page">
        <div class="content p-0">
            <!--            换一个首页shipper_home_2实施效果-->
            <iframe id="shipperHomeIframe" src="shipper_home_2.html" class="w-full h-full border-0"></iframe>
        </div>
        <div class="footer">
            <div class="tab-button active" onclick="showPage('shipper-home-iframe-page')">
                <span class="icon">🏠</span> 首页
            </div>
            <div class="tab-button" onclick="showPage('shipper-cargo-manage-iframe-page')">
                <span class="icon">📋</span> 货源管理
            </div>
            <div class="tab-button" onclick="showPage('shipper-my-page')">
                <span class="icon">👤</span> 我的
            </div>
        </div>
    </div>

    <!-- 4. Shipper's Cargo Management Page (iframe) -->
    <div id="shipper-cargo-manage-iframe-page" class="page">
        <div class="header">货源管理 (货方)</div>
        <div class="content p-0">
            <iframe id="cargoManageIframe" src="cargo_manage.html" class="w-full h-full border-0"></iframe>
        </div>
        <div class="footer">
            <div class="tab-button" onclick="showPage('shipper-home-iframe-page')">
                <span class="icon">🏠</span> 首页
            </div>
            <div class="tab-button active" onclick="showPage('shipper-cargo-manage-iframe-page')">
                <span class="icon">📋</span> 货源管理
            </div>
            <div class="tab-button" onclick="showPage('shipper-my-page')">
                <span class="icon">👤</span> 我的
            </div>
        </div>
    </div>

    <!-- 5. Shipper's "My" Page (iframe) -->
    <div id="shipper-my-page" class="page">
        <div class="header">我的 (货方) </div>
        <div class="content p-0">
            <iframe id="cargo_mineIframe" src="cargo_mine.html" class="w-full h-full border-0"></iframe>
        </div>
        <div class="footer">
            <div class="tab-button" onclick="showPage('shipper-home-iframe-page')">
                <span class="icon">🏠</span> 首页
            </div>
            <div class="tab-button" onclick="showPage('shipper-cargo-manage-iframe-page')">
                <span class="icon">📋</span> 货源管理
            </div>
            <div class="tab-button active" onclick="showPage('shipper-my-page')">
                <span class="icon">👤</span> 我的
            </div>
        </div>
    </div>

    <!-- 6. NEW: Driver's "Find Cargo" Page (as an iframe) 找货 (车方) -->
    <div id="driver-find-cargo-iframe-page" class="page">
        <div class="header">找货 (车方)，标题忽略</div>
        <div class="content p-0"> <!-- 移除内边距，让iframe占满 -->
            <iframe id="findCargoIframe" src="driver_find_cargo.html" class="w-full h-full border-0"></iframe>
        </div>
        <div class="footer">
            <div class="tab-button active" onclick="showPage('driver-find-cargo-iframe-page')">
                <span class="icon">🔍</span> 找货
            </div>
            <div class="tab-button" onclick="showPage('driver-cargo-manage-iframe-page')">
                <span class="icon">📦</span> 货源管理
            </div>
            <div class="tab-button" onclick="showPage('driver-my-page')">
                <span class="icon">👷</span> 我的
            </div>
        </div>
    </div>

    <!-- 7. MODIFIED: Driver's Cargo Management Page (now an iframe) -->
    <div id="driver-cargo-manage-iframe-page" class="page">
        <div class="header">货源管理 (车方)</div>
        <div class="content p-0"> <!-- 移除内边距，让iframe占满 -->
            <iframe id="driverCargoManageIframe" src="driver_cargo_manage.html" class="w-full h-full border-0"></iframe>
        </div>
        <div class="footer">
            <div class="tab-button" onclick="showPage('driver-find-cargo-iframe-page')">
                <span class="icon">🔍</span> 找货
            </div>
            <div class="tab-button active" onclick="showPage('driver-cargo-manage-iframe-page')">
                <span class="icon">📦</span> 货源管理
            </div>
            <div class="tab-button" onclick="showPage('driver-my-page')">
                <span class="icon">👷</span> 我的
            </div>
        </div>
    </div>

    <!-- 8. Driver's "My" Page -->
    <div id="driver-my-page" class="page">
        <div class="header">我的 (车方) 暂时和货混同</div>
        <div class="content p-0">
            <iframe id="find_cargo_mineIframe" src="cargo_mine.html" class="w-full h-full border-0"></iframe>
        </div>
        <div class="footer">
            <!-- MODIFIED: onclick points to new iframe page -->
            <div class="tab-button" onclick="showPage('driver-find-cargo-iframe-page')">
                <span class="icon">🔍</span> 找货
            </div>
            <div class="tab-button" onclick="showPage('driver-cargo-manage-iframe-page')">
                <span class="icon">📦</span> 货源管理
            </div>
            <div class="tab-button active" onclick="showPage('driver-my-page')">
                <span class="icon">👷</span> 我的
            </div>
        </div>
    </div>

    <!-- 9. Driver's Cargo Detail Page (Remains in main document) -->
    <div id="driver-cargo-detail-page" class="page">
        <div class="header detail-header">
            <!-- MODIFIED: Back arrow now goes to the iframe page -->
            <span class="back-arrow" onclick="showPage('driver-find-cargo-iframe-page')">←</span>
            <span class="header-title">货源详情</span>
            <button id="driver-detail-action-btn" class="action-btn header-action-btn"></button>
        </div>
        <div class="content detail-content">
            <div class="detail-section route-section">
                <div class="address-group">
                    <span class="address-icon origin-icon">📍</span>
                    <div class="address-info">
                        <div class="address-district" id="driver-origin-district"></div>
                        <div class="address-detail" id="driver-origin-detail"></div>
                    </div>
                </div>
                <span class="route-arrow">↓</span>
                <div class="address-group">
                    <span class="address-icon destination-icon">📍</span>
                    <div class="address-info">
                        <div class="address-district" id="driver-destination-district"></div>
                        <div class="address-detail" id="driver-destination-detail"></div>
                    </div>
                </div>
                <div class="mileage-section" id="driver-map-link-container">
                    <div class="mileage-info">
                        <span class="mileage-value" id="driver-mileage-display"></span>
                        <span class="mileage-reference">里程仅供参考 <span class="exclamation-icon">!</span></span>
                    </div>
                    <div class="map-link">
                        <span class="map-icon">🗺️</span>
                        <span>查看路线</span>
                    </div>
                </div>
            </div>
            <div class="detail-section cargo-info-section">
                <div class="section-title">货源信息</div>
                <div class="info-row"><span class="info-label">货物名称</span><span class="info-value" id="driver-cargo-name"></span></div>
                <div class="info-row"><span class="info-label">货物参数</span><span class="info-value" id="driver-cargo-params"></span></div>
                <div class="info-row"><span class="info-label">装卸时间</span><span class="info-value" id="driver-load-time-detail"></span></div>
                <div class="info-row"><span class="info-label">联系电话</span><span class="info-value" id="driver-contact-phone"></span></div>
                <div class="info-row"><span class="info-label">备注信息</span><span class="info-value" id="driver-remarks"></span></div>
            </div>
            <div class="detail-section fee-info-section">
                <div class="section-title">费用信息</div>
                <div class="info-row"><span class="info-label">运费</span><span class="info-value" id="driver-freight-cost"></span></div>
            </div>
        </div>
        <div class="detail-fixed-footer" id="driver-cargo-detail-footer"></div>
    </div>

    <!-- 10. NEW: Publish Iframe Page (for publish_1.html and publish_2.html) -->
    <div id="publish-iframe-page" class="page">
        <div class="content p-0">
            <iframe id="publishIframe" src="" class="w-full h-full border-0"></iframe>
        </div>
    </div>

    <!-- 10. NEW: Publish Iframe Page (for publish_1.html and publish_2.html) -->
    <div id="cargo_info-iframe-page" class="page">
        <div class="content p-0">
            <iframe id="cargoInfoIframe" src="" class="w-full h-full border-0"></iframe>
        </div>
    </div>

    <div id="car_cargo_info-iframe-page" class="page">
        <div class="content p-0">
            <iframe id="carCargoInfoIframe" src="" class="w-full h-full border-0"></iframe>
        </div>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/lucide-icons@latest/dist/lucide.min.js"></script>
<script>
    // Function to show a specific page and hide others
    function showPage(pageId) {
        const pages = document.querySelectorAll('.page');
        pages.forEach(page => {
            page.classList.remove('active');
        });
        const targetPage = document.getElementById(pageId);
        if(targetPage) {
            targetPage.classList.add('active');
        } else {
            console.error(`Page with ID "${pageId}" not found.`);
            return;
        }

        // Update active state of footer tabs if a footer is present
        const activePage = document.getElementById(pageId);
        const footer = activePage.querySelector('.footer');
        if (footer) {
            const tabButtons = footer.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
                // Check if the button's onclick directly calls showPage with the current pageId
                if (button.onclick && button.onclick.toString().includes(`showPage('${pageId}')`)) {
                    button.classList.add('active');
                }
            });
        }
    }

    /**
     * NEW: Handles the action from the name input modal.
     * @param {boolean} isConfirm - True if the confirm button was clicked, false for skip.
     */
    function handleModalClose(isConfirm) {
        if (isConfirm) {
            const nickname = document.getElementById('nickname-input').value;
            // 您可以在这里保存或使用用户输入的昵称。
            // 目前，我们只是在控制台打印它。
            console.log('用户昵称:', nickname || '未提供');
        }
        // Whether confirmed or skipped, proceed to the identity selection page.
        showPage('identity-page');
    }


    // This function is now defined in the parent window.
    // The iframe (driver_find_cargo.html) will call `window.parent.showDriverCargoDetailPage`.
    function showDriverCargoDetailPage(cargoItem) {
        // Populate route information
        document.getElementById('driver-origin-district').textContent = cargoItem.originDistrict;
        document.getElementById('driver-origin-detail').textContent = cargoItem.originDetail;
        document.getElementById('driver-destination-district').textContent = cargoItem.destinationDistrict;
        document.getElementById('driver-destination-detail').textContent = cargoItem.destinationDetail;

        // Populate cargo details
        document.getElementById('driver-cargo-name').textContent = cargoItem.cargoName;
        document.getElementById('driver-cargo-params').textContent = cargoItem.cargoParams;
        document.getElementById('driver-load-time-detail').textContent = cargoItem.loadTime;
        document.getElementById('driver-contact-phone').textContent = cargoItem.contactPhone;
        document.getElementById('driver-remarks').textContent = cargoItem.remarks;

        // Populate fee information
        document.getElementById('driver-freight-cost').textContent = cargoItem.freightCost;

        const mileageDisplay = document.getElementById('driver-mileage-display');
        mileageDisplay.textContent = '正在计算';
        setTimeout(() => {
            mileageDisplay.textContent = cargoItem.mileage || '未知里程';
        }, 1000);

        const driverMapLinkContainer = document.getElementById('driver-map-link-container');
        driverMapLinkContainer.onclick = () => {
            const originAddress = `${cargoItem.originDistrict}${cargoItem.originDetail}`;
            const destinationAddress = `${cargoItem.destinationDistrict}${cargoItem.destinationDetail}`;
            alert(`查看从 ${originAddress} 到 ${destinationAddress} 的路线`);
        };

        const driverDetailActionBtn = document.getElementById('driver-detail-action-btn');
        driverDetailActionBtn.textContent = '分享';
        driverDetailActionBtn.classList.remove('delete-btn');
        driverDetailActionBtn.onclick = () => alert('分享货源: ' + cargoItem.id);

        const driverDetailFooter = document.getElementById('driver-cargo-detail-footer');
        driverDetailFooter.innerHTML = '';

        const buttonsToCreate = [
            { text: '联系货主', className: '', action: () => alert('联系货主: ' + cargoItem.id) },
            { text: '立即抢单', className: 'primary', action: () => alert('立即抢单: ' + cargoItem.id) }
        ];

        buttonsToCreate.forEach(btnInfo => {
            const button = document.createElement('button');
            button.textContent = btnInfo.text;
            button.classList.add('action-btn');
            if (btnInfo.className) button.classList.add(btnInfo.className);
            button.onclick = btnInfo.action;
            driverDetailFooter.appendChild(button);
        });

        showPage('driver-cargo-detail-page');
    }

    // --- Other JS functions from the original file ---

    // Initialize driver's cargo management tabs
    function setupDriverCargoTabs() {
        const tabsContainer = document.querySelector('#driver-cargo-manage-iframe-page .tabs');
        if (tabsContainer) {
            const tabs = tabsContainer.querySelectorAll('.tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const allCargoContent = document.querySelectorAll('#driver-cargo-manage-iframe-page .cargo-content');
                    allCargoContent.forEach(content => content.style.display = 'none');
                    document.getElementById(`${this.dataset.tab}-cargo`).style.display = 'block';
                });
            });
        }
    }

    // Basic alert polyfill
    window.alert = (message) => {
        const appScreen = document.querySelector('.app-screen');
        if (!appScreen) {
            console.log(message);
            return;
        }
        const modal = document.createElement('div');
        modal.style.cssText = `position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); display: flex; justify-content: center; align-items: center; z-index: 1000;`;
        const modalContent = document.createElement('div');
        modalContent.style.cssText = `background-color: #fff; padding: 30px; border-radius: 15px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2); text-align: center; max-width: 80%;`;
        const messageText = document.createElement('p');
        messageText.textContent = message;
        messageText.style.marginBottom = '25px';
        messageText.style.fontWeight = 'bold';
        const closeButton = document.createElement('button');
        closeButton.textContent = '确定';
        closeButton.style.cssText = `background-color: #007bff; color: white; border: none; border-radius: 8px; padding: 12px 25px; font-size: 16px; cursor: pointer;`;
        closeButton.onclick = () => modal.remove();
        modalContent.appendChild(messageText);
        modalContent.appendChild(closeButton);
        modal.appendChild(modalContent);
        appScreen.appendChild(modal);
    };

    // Initialize the app on window load
    window.onload = function() {
        setupDriverCargoTabs();
        if (typeof lucide !== 'undefined' && lucide.createIcons) {
            lucide.createIcons();
        }
    };

    // This is the message listener for the main page (parent)
    // It listens for messages coming from iframes embedded within it.
    window.addEventListener('message', function(event) {
        const data = event.data;
        console.log(`Main page received message from iframe:`, data);

        if (data.action === 'showPage' && data.pageId) {
            // Directly call showPage as it's defined in the global scope of the parent window.
            showPage(data.pageId);
        } else if (data.action === 'loadPublishPage') {
            const publishIframe = document.getElementById('publishIframe');
            publishIframe.src = data.url;
            showPage('publish-iframe-page'); // Show the iframe container page
        } else if (data.action === 'navigatePublishIframe') {
            const publishIframe = document.getElementById('publishIframe');
            publishIframe.src = data.url;
            // No need to call showPage again, as publish-iframe-page is already active
        } else if (data.action === 'closePublishFlow') {
            // Close the publish iframe and return to shipper home
            showPage('shipper-home-iframe-page');
            const publishIframe = document.getElementById('publishIframe');
            publishIframe.src = ''; // Clear iframe content
        } else if (data.action === 'cargoInfoPage') {
            const cargoInfoIframe = document.getElementById('cargoInfoIframe');
            cargoInfoIframe.src = data.url;
            showPage('cargo_info-iframe-page'); // Show the iframe container page
        }  else if (data.action === 'driverCargoInfoPage') {
            const driverCargoInfoIframe = document.getElementById('carCargoInfoIframe');
            driverCargoInfoIframe.src = data.url;
            showPage('car_cargo_info-iframe-page'); // Show the iframe container page
        }else if (data.action === 'cargoManager') {
            showPage('shipper-cargo-manage-iframe-page')
        }else if (data.action === 'driverCargoManager') {
            showPage('driver-cargo-manage-iframe-page')
        } if (data.action === 'driverFindCargo') {
            showPage('driver-find-cargo-iframe-page')
        }

    }, false);
</script>
</body>
</html>
