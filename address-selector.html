<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>选择地址</title>
    <style>
        /* 基础样式，在页面居中显示手机模拟框 */
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: #f8f8f8;
            display: flex;
            flex-direction: column;
        }

        /* 新增：外部容器样式 */
        body {
            background-color: #f0f2f5;
            justify-content: center;
            align-items: center;
        }

        /* 新增：手机屏幕模拟框 */
        .app-screen {
            width: 375px;
            height: 100%; /* 调整为撑满父容器 */
            max-height: 812px; /* 限制最大高度 */
            background-color: #fff;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .address-selector {
            display: flex;
            flex-direction: column;
            height: 100%;
            background-color: #fff;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
            height: 50px;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
        }
        .header .title {
            font-size: 17px;
            font-weight: 600;
        }
        .header .close-btn {
            font-size: 24px;
            color: #999;
            cursor: pointer;
            border: none;
            background: none;
            padding: 5px;
        }
        .tabs {
            display: flex;
            padding: 0 16px;
            border-bottom: 1px solid #e0e0e0;
            flex-shrink: 0;
        }
        .tab-item {
            padding: 12px 4px;
            margin-right: 20px;
            font-size: 15px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100px;
        }
        .tab-item.active {
            color: #f06292;
            border-bottom-color: #f06292;
            font-weight: 600;
        }
        .content {
            flex-grow: 1;
            overflow-y: auto;
        }
        .list {
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .list-item {
            padding: 14px 16px;
            font-size: 15px;
            cursor: pointer;
            border-bottom: 1px solid #f5f5f5;
        }
        .list-item:hover {
            background-color: #fafafa;
        }
        .list-item.active {
            color: #f06292;
            font-weight: 600;
        }
    </style>
</head>
<body>

<div class="app-screen">
    <div class="address-selector">
        <div class="header">
            <span class="title">选择地址示意，跟目前开发版有差异</span>
            <button id="closeBtn" class="close-btn">&times;</button>
        </div>
        <div id="tabsContainer" class="tabs">
            <!-- Tabs will be generated by JS -->
        </div>
        <div id="contentContainer" class="content">
            <!-- Lists will be generated by JS -->
        </div>
    </div>
</div>

<script>
    // 简化的中国省市区数据
    const cityData = [
        { "name": "北京市", "children": [
            { "name": "北京市", "children": [
                { "name": "东城区" }, { "name": "西城区" }, { "name": "朝阳区" }, { "name": "丰台区" }, { "name": "石景山区" }, { "name": "海淀区" }
            ]}
        ]},
        { "name": "上海市", "children": [
            { "name": "上海市", "children": [
                { "name": "黄浦区" }, { "name": "徐汇区" }, { "name": "长宁区" }, { "name": "静安区" }, { "name": "普陀区" }, { "name": "虹口区" }
            ]}
        ]},
        { "name": "广东省", "children": [
            { "name": "广州市", "children": [
                { "name": "荔湾区" }, { "name": "越秀区" }, { "name": "海珠区" }, { "name": "天河区" }
            ]},
            { "name": "深圳市", "children": [
                { "name": "罗湖区" }, { "name": "福田区" }, { "name": "南山区" }, { "name": "宝安区" }
            ]},
            { "name": "东莞市", "children": [
                { "name": "莞城区" }, { "name": "南城区" }, { "name": "东城区" }, { "name": "万江区" }
            ]}
        ]},
        { "name": "江苏省", "children": [
            { "name": "南京市", "children": [
                { "name": "玄武区" }, { "name": "秦淮区" }, { "name": "建邺区" }
            ]},
            { "name": "苏州市", "children": [
                { "name": "姑苏区" }, { "name": "虎丘区" }, { "name": "吴中区" }
            ]}
        ]}
    ];

    const state = {
        type: 'origin', // or 'destination'
        province: null,
        city: null,
        district: null,
        currentLevel: 0, // 0: province, 1: city, 2: district
    };

    const tabsContainer = document.getElementById('tabsContainer');
    const contentContainer = document.getElementById('contentContainer');
    const closeBtn = document.getElementById('closeBtn');

    // 初始化
    function init() {
        const urlParams = new URLSearchParams(window.location.search);
        state.type = urlParams.get('type') || 'origin';
        render();

        closeBtn.addEventListener('click', () => {
            window.parent.postMessage({ action: 'close' }, '*');
        });
    }

    // 渲染视图
    function render() {
        renderTabs();
        renderContent();
    }

    // 渲染Tabs
    function renderTabs() {
        tabsContainer.innerHTML = '';
        const tabs = [state.province, state.city, state.district];
        let hasPlaceholder = false;

        tabs.forEach((tab, index) => {
            if (tab) {
                const tabEl = document.createElement('div');
                tabEl.className = 'tab-item';
                tabEl.textContent = tab;
                tabEl.onclick = () => {
                    state.currentLevel = index;
                    // 清除后续选择
                    if (index === 0) { state.city = null; state.district = null; }
                    if (index === 1) { state.district = null; }
                    render();
                };
                tabsContainer.appendChild(tabEl);
            } else if (!hasPlaceholder) {
                const tabEl = document.createElement('div');
                tabEl.className = 'tab-item active';
                tabEl.textContent = '请选择';
                tabsContainer.appendChild(tabEl);
                hasPlaceholder = true;
            }
        });

        const activeTab = tabsContainer.children[state.currentLevel];
        if (activeTab && !activeTab.classList.contains('active')) {
            activeTab.classList.add('active');
        }
    }

    // 渲染列表内容
    function renderContent() {
        contentContainer.innerHTML = '';
        const listEl = document.createElement('ul');
        listEl.className = 'list';

        let data = [];
        if (state.currentLevel === 0) {
            data = cityData;
        } else if (state.currentLevel === 1) {
            const selectedProvince = cityData.find(p => p.name === state.province);
            data = selectedProvince ? selectedProvince.children : [];
        } else if (state.currentLevel === 2) {
            const selectedProvince = cityData.find(p => p.name === state.province);
            const selectedCity = selectedProvince ? selectedProvince.children.find(c => c.name === state.city) : null;
            data = selectedCity ? selectedCity.children : [];
            // 添加“全市”选项
            data.unshift({ name: '全市' });
        }

        data.forEach(item => {
            const itemEl = document.createElement('li');
            itemEl.className = 'list-item';
            itemEl.textContent = item.name;
            itemEl.onclick = () => handleSelect(item.name);
            listEl.appendChild(itemEl);
        });

        contentContainer.appendChild(listEl);
    }

    // 处理选择
    function handleSelect(name) {
        if (state.currentLevel === 0) {
            state.province = name;
            state.currentLevel = 1;
            render();
        } else if (state.currentLevel === 1) {
            state.city = name;
            state.currentLevel = 2;
            render();
        } else if (state.currentLevel === 2) {
            state.district = name;
            let location = '';
            if (state.district === '全市') {
                location = state.city; // 如果选全市，就显示到市
            } else {
                location = state.district; // 否则显示区县
            }

            // 发送消息给父窗口
            window.parent.postMessage({
                action: 'select',
                type: state.type,
                location: location
            }, '*');
        }
    }

    init();

</script>
</body>
</html>
